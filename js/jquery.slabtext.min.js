(function(e){e.fn.slabText=function(t){var n={fontRatio:.472,boxRatio:1,fixedHeight:false,borderBox:false,forceNewCharCount:true,wrapAmpersand:true,headerBreakpoint:null,viewportBreakpoint:null,noResizeEvent:false,resizeThrottleTime:300,maxFontSize:999,postTweak:true,precision:3,minCharsPerLine:0};e("body").addClass("slabtexted");return this.each(function(){if(t){e.extend(n,t)}var r=e(this),i=e("span.slabtext",r).length,s=i?[]:String(e.trim(r.text())).replace(/\s{2,}/g," ").split(" "),o=null,u=null,a=n.fontRatio,f=n.boxRatio,l=n.fixedHeight,c=n.borderBox,h=n.forceNewCharCount,p=n.headerBreakpoint,d=n.viewportBreakpoint,v=n.postTweak,m=n.precision,g=n.resizeThrottleTime,y=n.minCharsPerLine,b=null,w=e(window).width(),E=r.find("a:first").attr("href")||r.attr("href"),S=E?r.find("a:first").attr("title"):"";if(!i&&y&&s.join(" ").length<y){return}var x=function(){var e=jQuery('<div style="display:none;font-size:1em;margin:0;padding:0;height:auto;line-height:1;border:0;">Â </div>').appendTo(r),t=e.height();e.remove();return t};var T=function(){var g=r.width(),b=l?r.height():g/f,T;r.removeClass("slabtextdone slabtextinactive");if(d&&d>w||p&&p>g){r.addClass("slabtextinactive");return}T=x();if(!i&&(h||T!=o)){o=T;var N=s.join(" ").length,C=12,k=g/(C*a),L=Math.floor(b/k),A=Math.min(60,Math.max(Math.round(N/L),1)),O=0,M=[],_=0,D="",P="",H="",B,j,F;if(A!=u){u=A;while(O<s.length){P="";while(P.length<u){D=P;P+=s[O]+" ";if(++O>=s.length){break}}if(y){B=s.slice(O).join(" ");if(B.length<y){P+=B;D=P;O=s.length+2}}j=u-D.length;F=P.length-u;if(j<F&&D.length>=(y||2)){H=D;O--}else{H=P}H=e("<div/>").text(H).html();if(n.wrapAmpersand){H=H.replace(/&/g,'<span class="amp">&</span>')}H=e.trim(H);M.push('<span class="slabtext">'+H+"</span>")}r.html(M.join(" "));if(E){r.wrapInner('<a href="'+E+'" '+(S?'title="'+S+'" ':"")+"/>")}}}else{o=T}var I=0;e("span.slabtext",r).each(function(){var t=e(this),i=t.text(),s=i.split(" ").length>1,u,a,f;if(v){t.css({"word-spacing":0,"letter-spacing":0})}r.css("font-size",1+"em");t.css("font-size",1+"em");a=g/t.width();var l=Math.min((o*a).toFixed(m),n.maxFontSize)/o;t.css("font-size",l+"em");I+=t.height();u=!!v?g-t.width():false;if(u){t.css((s?"word":"letter")+"-spacing",(u/(s?i.split(" ").length-1:i.length)).toFixed(m)+"px")}});var q=1;if(I>b){q=(b/I).toFixed(m);r.css("font-size",q+"em")}if(c)r.css("padding",(b-I*q)/2+"px 0");r.addClass("slabtextdone")};T();if(!n.noResizeEvent){e(window).resize(function(){if(e(window).width()==w){return}w=e(window).width();clearTimeout(b);b=setTimeout(T,g)})}})}})(jQuery)
